/** * @author bofa1ex * @since 2020/4/15 * @description * [问题描述] * 由于内部使用特殊的ReplayingDecoderByteBuf, 里面的terminated成员变量, 在默认为false的情况下 * #readableBytes, #capacity, #forEachByteDesc 这几个API拿到的数据与预期不符. * 笔者个人觉得这个terminated变量除了判断当前buffer是否可读以外, 没有其他实质性的作用, 并且严重影响到解析框架对报文编解码的使用. * 因此, 需要考虑对其ReplayingDecoderByteBuf内部做一定的小改动. * ********************************************************************************************************************** * [解决时遇到的问题] * 1. ReplayingDecoder#ReplayingDecoderByteBuf变量, 仅限package内访问. * 2. ByteToMessageDecoder#cumulation, 仅限package内访问 * 3. ByteToMessageDecoder#channelRead方法, #fireChannelRead方法, #channelInputClosed方法等, 需要创建CodecOutputList该对象, 而该CodecOutputList类仅限package内访问. * ********************************************************************************************************************** * [解决方案] * 1. ReplayingDecoderByteBuf类复写 => ReplayingDecoderByteBufEx, 修改#readableBytes, #capacity, #forEachByteDesc方法 * 2. ReplayingDecoder类复写 => 继承于ChannelInboundHandlerAdapter类, 这里不选择继承ByteToMessageDecoder * 问题中已经描述过了, ByteToMessageDecoder有些方法和变量由于权限原因, 不能复写调用. * 3. CodecOutputList类复写 => CodecOutputListEx, ReplayingDecoderEx中的部分APi所需, 但是该CodecOutputList类由于权限原因, 不能复写调用. * * [最后] 如果有更好的做法, 请提出你的想法, 谢谢 */package com.bofa.protocol.communication.commons.netty.extension;